{{ $currentPage := . }}
{{ $docVersion := .Scratch.Get "docVersion" }}
{{ $menuName := .Scratch.Get "docVersion" }}

{{ if .Scratch.Get "leftNavName" }}
  {{ $menuName = .Scratch.Get "leftNavName" }}
  {{ $menuName = printf "%s_%s" $docVersion $menuName }}

  {{ if not (isset .Site.Menus $menuName) }}
    {{ $menuName = $docVersion }}
  {{ end }}
{{ end }}

<div class="docs-menu desktop-hide">Docs Menu</div>
<div class="left-sidebar-wrap">
  <div class="left-sidebar-wrap-inner">
    <nav>
      <ul class="list pa0 nl2">
        {{ range $key, $value := .Site.Menus }}
          {{- if eq $menuName $key }}
            {{ range .ByWeight }}
              {{- if .Params.section }}
                {{ $post := printf "%s" .Post }}
                {{ $viewAll := "" }}
                {{- if eq .Identifier "view-all-products" }}
                  {{ $viewAll = " view-all-products" }}
                {{- end }}

                <li class="section{{- if .HasChildren }} submenu parent-menu{{- end }}{{- if .Params.hideLink }} unlink-list{{- end }}{{ $viewAll }}">
                  {{ if not .Params.hideLink }}
                    <a href="{{ if .URL }}{{ .URL }}{{ else }}javascript:void(0){{ end }}" title="{{- if .Title }}{{.Title}}{{else}}{{.Name}}{{- end }}" data-identifier="{{ .Identifier }}"{{- if .Params.newTab }}target="_blank" rel="noopener"{{- end }}>{{ .Name }}</a>
                  {{ end }}

                  {{- if .HasChildren }}
                    {{ $parentIdentifier := printf "%s" .Identifier }}
                    {{ if not .Params.hideLink }}
                      <i></i>
                    {{ end }}

                    {{ template "section-tree-nav-section" (dict "currentMenu" . "currentPage" $currentPage "docVersion" $docVersion "parentIdentifier" $parentIdentifier ) }}
                  {{- end }}
                </li>
              {{- end }}
            {{- end }}
          {{- end }}
        {{- end }}
      </ul>

      <ul class="left-bottom-nav">
        {{ range .Site.Menus.leftbottom }}
          <li class="bottom-link{{- if .HasChildren }} section submenu parent-menu{{- end }}">
            <a href="{{ if .URL }}{{ .URL }}{{ else }}javascript:void(0){{ end }}" title="{{ .Name }}"{{- if .Params.newTab }}target="_blank" rel="noopener"{{- end }}>{{ .Pre }}{{ .Name }}</a>
            {{ .Post }}
            {{- if .HasChildren }}
              <ul class="internal animated list">
                {{- range .Children }}
                  <li class="bottom-link">
                    <a href="{{ if .URL }}{{ .URL }}{{ else }}javascript:void(0){{ end }}" title="{{ .Name }}"{{- if .Params.newTab }}target="_blank" rel="noopener"{{- end }}>{{ .Pre }}{{ .Name }}</a>
                  </li>
                {{- end }}
              </ul>
            {{- end }}
          </li>
        {{- end }}
      </ul>
    </nav>
    <div class="hover-collapse">.</div>
  </div>

  <div class="side-nav-collapse-toggle-2">
    <div class="collapse-nav-tip">Collapse
      <span>[</span>
    </div>
  </div>

</div>

{{ define "section-tree-nav-section" -}}
  {{ $currentMenu := .currentMenu }}
	{{ $currentPage := .currentPage }}
  {{ $docVersion := .docVersion }}
	{{ $parentIdentifier := .parentIdentifier }}

  <ul class="animated list{{if $currentPage.HasMenuCurrent $docVersion $currentMenu }} active-element{{ end }}" data-identifier="{{ $parentIdentifier }}">
    {{- range $index, $item := $currentMenu.Children }}
      {{- if not .Params.hide }}
        {{ if le (len (where (first (add $index 1) $currentMenu.Children) "Name" .Name)) 1 }}
          <li class="{{- if .HasChildren }}submenu{{- end }}">
            <a href="{{- if .URL }}{{ .URL }}{{- else }}javascript:void(0){{ end }}" class="link{{if $currentPage.IsMenuCurrent $docVersion . }} active{{end}}" title="{{- if .Title }}{{.Title}}{{else}}{{.Name}}{{- end }}"{{- if .Params.newTab }}target="_blank" rel="noopener"{{- end }}>
              {{ .Name }}
            </a>

            {{- if .HasChildren }}
              {{ $parentIdentifier := printf "%s" .Identifier }}
              {{ if not .Params.hideLink }}
                <i></i>
              {{ end }}

              {{ template "section-tree-nav-section" (dict "currentMenu" . "currentPage" $currentPage "docVersion" $docVersion "parentIdentifier" $parentIdentifier ) }}
            {{- end }}
          </li>
        {{- end }}
      {{- end }}
    {{- end }}
  </ul>
{{- end }}
