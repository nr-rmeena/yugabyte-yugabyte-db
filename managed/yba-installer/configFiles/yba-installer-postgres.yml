 services:
  - name: postgresService
    fileName: /etc/systemd/system/postgres.service
    contents: |
      [Unit]
      Description=Postgres
      Wants=network-online.target
      After=network-online.target

      [Service]
      User=postgres
      Group=postgres
      Type=forking

      # no timeout in starting up - if crash recovery is needed it can take quite some time, and
      # we don't want systemd to kill the process in that case
      TimeoutSec=infinity

      ExecStart={{ installRoot }}/postgres/bin/pg_ctl -D {{ installRoot }}/postgres/data \
      -o "-k {{ installRoot }}/postgres/run/postgresql/" start
      ExecStop={{ installRoot }}/postgres/bin/pg_ctl -D {{ installRoot }}/postgres/data \
      -o "-k {{ installRoot }}/postgres/run/postgresql/" stop

      Restart=always
      RestartSec={{ yamlPath ".postgres.restartSeconds"}}

      [Install]
      WantedBy=multi-user.target
